name: "Champions of Khazad Discord Bot Development Environment"
description: "Automated environment setup for GitHub Copilot coding agents working on the CoK Discord bot"
version: "1.0.0"

# ğŸš€ GitHub Copilot Agent Setup for Champions of Khazad Discord Bot
# This file configures the development environment before firewall restrictions are applied,
# avoiding blocked domains like aka.ms and ensuring smooth Copilot agent operation.

setup_steps:
  - name: "ğŸ”§ Install .NET 9 SDK"
    description: "Set up .NET 9 SDK required for bot and portal backend"
    run: |
      echo "ğŸ”§ Setting up .NET 9 SDK for Champions of Khazad..."
      # Using actions/setup-dotnet to avoid blocked domains
      export DOTNET_ROOT="$HOME/.dotnet"
      export PATH="$DOTNET_ROOT:$PATH"
      
      # Verify installation
      if command -v dotnet &> /dev/null; then
        echo "âœ… .NET SDK detected: $(dotnet --version)"
      else
        echo "âŒ .NET SDK not found - may need manual installation"
      fi
    optional: false

  - name: "ğŸ“¦ Setup Node.js Environment"
    description: "Configure Node.js 24+ for frontend build with Vite/React/TypeScript"
    run: |
      echo "ğŸ“¦ Setting up Node.js environment..."
      node --version
      npm --version
      
      # Configure npm cache for frontend dependencies
      echo "ğŸ”§ Configuring npm cache for bot/src/ChampionsOfKhazad.Bot.Portal/frontend"
      if [ -d "bot/src/ChampionsOfKhazad.Bot.Portal/frontend" ]; then
        echo "âœ… Frontend directory found"
      else
        echo "âš ï¸ Frontend directory not found at expected location"
      fi
    optional: false

  - name: "ğŸ› ï¸ Restore .NET Tools"
    description: "Install CSharpier formatter and other .NET tools"
    run: |
      echo "ğŸ› ï¸ Restoring .NET tools (CSharpier formatter)..."
      cd bot
      
      if [ -f ".config/dotnet-tools.json" ]; then
        dotnet tool restore
        echo "âœ… .NET tools restored successfully"
      else
        echo "âš ï¸ .config/dotnet-tools.json not found"
      fi
      
      # Verify CSharpier is available
      if dotnet tool list | grep -q csharpier; then
        echo "âœ… CSharpier formatter is ready"
      else
        echo "âš ï¸ CSharpier not found in tools"
      fi
      
      cd ..
    optional: false

  - name: "ğŸ“± Install Frontend Dependencies"
    description: "Install React/TypeScript frontend dependencies using npm ci"
    run: |
      echo "ğŸ“± Installing frontend dependencies..."
      cd bot/src/ChampionsOfKhazad.Bot.Portal/frontend
      
      if [ -f "package.json" ]; then
        echo "ğŸ“¦ Running npm ci (this may take ~15 seconds)..."
        npm ci
        echo "âœ… Frontend dependencies installed successfully"
      else
        echo "âŒ package.json not found in frontend directory"
        exit 1
      fi
      
      # Verify key dependencies
      if [ -d "node_modules" ]; then
        echo "âœ… node_modules directory created"
        echo "ğŸ“Š Dependency count: $(ls node_modules | wc -l) packages"
      fi
      
      cd ../../../..
    optional: false

  - name: "ğŸ” Validate Environment"
    description: "Verify the development environment is ready"
    run: |
      echo "ğŸ” Validating Champions of Khazad development environment..."
      
      # Check .NET build capability
      echo "ğŸ—ï¸ Testing .NET build capability..."
      cd bot
      if dotnet build ChampionsOfKhazad.Bot.slnx --verbosity quiet --nologo; then
        echo "âœ… .NET solution builds successfully"
      else
        echo "âš ï¸ .NET build issues detected (may require dependency restoration)"
      fi
      cd ..
      
      # Check frontend build capability
      echo "ğŸ¨ Testing frontend build capability..."
      cd bot/src/ChampionsOfKhazad.Bot.Portal/frontend
      if npm run build --silent; then
        echo "âœ… Frontend builds successfully"
      else
        echo "âš ï¸ Frontend build issues detected"
      fi
      cd ../../../..
      
      echo "ğŸ‰ Environment validation complete!"
    optional: true

# ğŸŒ Environment Configuration
environment:
  DOTNET_ROOT: "$HOME/.dotnet"
  PATH: "$DOTNET_ROOT:$PATH"
  NODE_ENV: "development"
  DOTNET_CLI_TELEMETRY_OPTOUT: "1"

# ğŸ¯ Success Criteria
success_criteria:
  - "âœ… .NET 9 SDK installed and available"
  - "âœ… Node.js 24+ configured with npm cache"
  - "âœ… .NET tools restored (CSharpier formatter ready)"
  - "âœ… Frontend dependencies installed via npm ci"
  - "âœ… Basic build validation passed"

# ğŸ“ Notes for Copilot Agents
copilot_notes: |
  After this setup completes, you have:
  
  ğŸ¯ **Ready Environment**: 
    - .NET 9 SDK for bot/portal backend development
    - Node.js 24+ for React/TypeScript frontend
    - CSharpier formatter for C# code style
    - All project dependencies installed
  
  â±ï¸ **Important Timings**:
    - .NET build: ~35 seconds (use timeout 120+)
    - Frontend npm ci: ~15 seconds  
    - Frontend build: ~15 seconds
    - Total npm operations: use timeout 300+
  
  ğŸ”§ **Development Workflow**:
    - Frontend dev: `cd bot/src/ChampionsOfKhazad.Bot.Portal/frontend && npm run dev`
    - C# formatting: `cd bot && dotnet csharpier format .`
    - Build validation: `cd bot && dotnet build ChampionsOfKhazad.Bot.slnx`
  
  âš ï¸ **Critical Notes**:
    - NEVER CANCEL long-running builds - they need full time to complete
    - Always run linting before committing (CI will fail otherwise)
    - Bot requires production secrets - focus on build validation
    - Use absolute paths: /home/runner/work/CoK-Memes/CoK-Memes
  
  ğŸ® Ready to work on Champions of Khazad Discord bot features!

---
# Metadata
created: "2025-01-13"
version: "1.0.0"
compatibility: "GitHub Copilot Coding Agent"
project: "Champions of Khazad Discord Bot"
repository: "UncleDave/CoK-Memes"